% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/enrichment-metagene.R
\name{enrichment_metagene_plot}
\alias{enrichment_metagene_plot}
\alias{enrichment_metagene_plot,ribotrans-method}
\title{Create enrichment metagene plots for ribosome profiling data}
\usage{
enrichment_metagene_plot(object, ...)

\S4method{enrichment_metagene_plot}{ribotrans}(
  object,
  merge_rep = FALSE,
  var_alpha = 0.5,
  selected_genes = NULL,
  do_offset_correct = FALSE,
  position_shift = 0,
  method = c("median", "mean", "sum"),
  do_bootstrap = FALSE,
  boot_n = 1000,
  conf = 0.95,
  min_cds_length = 600,
  min_counts = 64,
  exclude_length = c(90, 90),
  type = c("rel2start", "rel2stop"),
  return_data = FALSE,
  mode = c("nt", "codon"),
  read_length = c(25, 35),
  rel2st_dist = c(-50, 100),
  rel2sp_dist = c(-100, 50),
  facet_wrap = ggplot2::facet_wrap(~sample)
)
}
\arguments{
\item{object}{A \code{ribotrans} object containing ribosome profiling data.}

\item{...}{Additional arguments (currently unused).
Default is \code{ggplot2::facet_wrap(~sample)}.}

\item{merge_rep}{Logical. If \code{TRUE}, replicates will be merged by sample group. Default is \code{FALSE}.}

\item{var_alpha}{Numeric value between 0 and 1 indicating the transparency of the confidence interval
ribbons. Default is 0.5.}

\item{selected_genes}{Character vector of gene names to include in the analysis. If \code{NULL} (default),
all genes will be used.}

\item{do_offset_correct}{Logical. If \code{TRUE}, apply offset correction to read positions. Default is \code{FALSE}.}

\item{position_shift}{Integer indicating the number of nucleotides to shift positions. Default is 0.}

\item{method}{Character string specifying the method for aggregating values across genes.
Must be one of "median" (default), "mean", or "sum".}

\item{do_bootstrap}{Logical. If \code{TRUE}, perform bootstrap analysis to estimate confidence intervals.
Default is \code{FALSE}.}

\item{boot_n}{Integer specifying the number of bootstrap iterations. Default is 1000.}

\item{conf}{Numeric value between 0 and 1 specifying the confidence level for bootstrap intervals.
Default is 0.95.}

\item{min_cds_length}{Integer specifying the minimum CDS length in nucleotides to include in analysis.
Default is 600.}

\item{min_counts}{Integer specifying the minimum number of counts per gene to include in analysis.
Default is 64.}

\item{exclude_length}{Numeric vector of length 2 specifying regions to exclude from start 0 and end 1
of CDS. Default is c(90, 90).}

\item{type}{Character string specifying the reference point for alignment.
Must be one of "rel2start" (default) or "rel2stop".}

\item{return_data}{Logical. If \code{TRUE}, return the plot data instead of the plot. Default is \code{FALSE}.}

\item{mode}{Character string specifying the x-axis units.
Must be one of "nt" (nucleotides, default) or "codon".}

\item{read_length}{Numeric vector of length 2 specifying the range of read lengths to include "min, max".
Default is c(25, 35).}

\item{rel2st_dist}{Numeric vector of length 2 specifying the distance range relative to start codon "min, max".
Default is c(-50, 100).}

\item{rel2sp_dist}{Numeric vector of length 2 specifying the distance range relative to stop codon "min, max".
Default is c(-100, 50).}

\item{facet_wrap}{A facet specification for \code{ggplot2} to control faceting of the plot.}
}
\value{
If \code{return_data = FALSE} (default), returns a \code{ggplot} object of the metagene plot.
If \code{return_data = TRUE}, returns a data frame containing the processed data used for plotting.
}
\description{
This function generates metagene plots showing the enrichment of ribosome footprints
around start or stop codons. It calculates the ratio of IP to total reads for each position
relative to start/stop codons, and can display the average profile across genes with various
statistical approaches.
}
\details{
The function calculates the enrichment of ribosome footprints around start or stop codons by
dividing IP signals by the corresponding total RNA signals at each position. It can handle
multiple experimental conditions and replicates, and provides various options to customize the
visualization and statistical analysis.

The enrichment values are normalized to facilitate comparison between samples. The normalization
is performed by dividing each position's enrichment by the average enrichment across all positions
in the analyzed range.

When \code{do_bootstrap = TRUE}, confidence intervals are estimated using bootstrap resampling
of genes. When \code{merge_rep = TRUE}, data from replicates are averaged and standard deviation
is shown.
}
\note{
The parameters \code{merge_rep} and \code{do_bootstrap} cannot both be \code{TRUE} simultaneously.
}
\examples{
\dontrun{
# Basic usage with default parameters
enrichment_metagene_plot(ribo_obj)

# Plot enrichment around stop codons with bootstrapping
enrichment_metagene_plot(ribo_obj,
                        type = "rel2stop",
                        do_bootstrap = TRUE,
                        boot_n = 500)

# Plot enrichment for specific genes, return data instead of plot
gene_data <- enrichment_metagene_plot(ribo_obj,
                                     selected_genes = c("ACTB", "GAPDH"),
                                     return_data = TRUE)

# Plot with custom parameters and merge replicates
enrichment_metagene_plot(ribo_obj,
                        merge_rep = TRUE,
                        method = "mean",
                        min_cds_length = 1000,
                        min_counts = 100,
                        mode = "codon")

# Plot with custom faceting
enrichment_metagene_plot(ribo_obj,
                        facet_wrap = ggplot2::facet_wrap(~sample_group, ncol = 2))
}

}
\seealso{
\code{\link{do_offset_correction}} for offset correction methods
}
