% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/serp-visualization.R
\name{enrichment_plot2}
\alias{enrichment_plot2}
\alias{enrichment_plot2,serp-method}
\title{Plot smoothed enrichment ratio (IP/Total) for ribosome profiling}
\usage{
enrichment_plot2(object, ...)

\S4method{enrichment_plot2}{serp}(
  object,
  merge_rep = FALSE,
  var_alpha = 0.5,
  smooth = TRUE,
  window_size = 45,
  retain_cds = TRUE,
  mode = c("codon", "nt"),
  new_signal_range = FALSE,
  enrich_threshold = 1,
  range_x = 0.99,
  range_y = 0.98,
  range_size = 4,
  range_digit = 1,
  exon_line = c("grey", 3),
  cds_line = c("grey30", 7),
  facet = facet_grid(sample ~ rname, switch = "y"),
  nrow = NULL,
  ncol = NULL,
  return_data = FALSE
)
}
\arguments{
\item{object}{An object of class \code{serp} containing:
\itemize{
\item \verb{@total_occupancy}: total RPM per position
\item \verb{@ip_occupancy}: IP RPM per position
\item \verb{@features}: transcript annotation (exons, CDS)
\item \verb{@library}: library sizes and sample info
\item \verb{@gene_name}: the gene to plot
}}

\item{...}{Additional arguments (currently unused).}

\item{merge_rep}{Logical. If \code{TRUE}, merge biological replicates and plot mean ± SD shading. Default \code{FALSE}.}

\item{var_alpha}{Numeric. Transparency value for SD error ribbon if \code{merge_rep = TRUE}.}

\item{smooth}{Logical. Whether to apply rolling mean smoothing (\code{zoo::rollsum}) to RPM profiles. Default \code{TRUE}.}

\item{window_size}{Integer. Size of the rolling window for smoothing. Default \code{45}.}

\item{retain_cds}{Logical. If \code{TRUE}, restrict analysis to CDS region only; otherwise include UTRs.}

\item{mode}{Character. Units on x-axis: \code{"codon"} for codon positions or \code{"nt"} for nucleotide positions.}

\item{new_signal_range}{Logical. Whether to annotate the maximum signal range on the plot.}

\item{enrich_threshold}{Numeric. Threshold line to highlight enrichment level, default \code{1}.}

\item{range_x}{Numeric. Positions (npc units) to place the signal range annotation if enabled.}

\item{range_y}{Numeric. Positions (npc units) to place the signal range annotation if enabled.}

\item{range_size}{Numeric. Font size of the signal range annotation.}

\item{range_digit}{Integer. Number of digits to display in the signal range maximum.}

\item{exon_line}{A character vector specifying color and thickness for exon structure annotations.}

\item{cds_line}{A character vector specifying color and thickness for CDS structure annotations.}

\item{facet}{A \code{ggplot2} faceting function, e.g., \code{facet_grid(sample ~ rname, switch = "y")}.}

\item{nrow}{Integers. Number of rows or columns if plotting multiple transcripts at once.}

\item{ncol}{Integers. Number of rows or columns if plotting multiple transcripts at once.}

\item{return_data}{Logical. If \code{TRUE}, return processed data instead of a plot.}
}
\value{
\itemize{
\item If \code{return_data = FALSE}, returns a \code{ggplot} (possibly combined with \code{cowplot::plot_grid}) showing the enrichment ratio profiles.
\item If \code{return_data = TRUE}, returns a \code{data.frame} containing:
\itemize{
\item \code{rname}, \code{sample}, \code{pos} - position, sample, transcript ID
\item \code{rpm.x} (total) and \code{rpm.y} (IP) RPM values
\item \code{sm1}, \code{sm2} - smoothed values (if smoothing is enabled)
\item \code{smratio} - smoothed ratio of IP/Total
\item \code{sd} - standard deviation of ratio (if merging replicates)
}
}
}
\description{
\code{enrichment_plot2} generates enrichment plots showing the ratio between IP and Total RNA signals across transcripts using rpm (Reads Per Million) normalized values. It optionally smooths the profile using a sliding window and can merge biological replicates by plotting the mean and standard deviation shading.
}
\details{
\itemize{
\item The function calculates per-position rpm ratio (IP/Total) and optionally smooths using a centered rolling sum (sliding window) with size \code{window_size}.
\item When \code{merge_rep = TRUE}, replicates are averaged by \code{sample_group}, and an error ribbon ±sd is drawn for variability visualization.
\item Supports two modes of display:
\itemize{
\item \code{"codon"}: collapsing 3-nt to codon units (only for CDS retained region).
\item \code{"nt"}: nucleotide units.
}
\item Multiple transcripts can be plotted together using ggplot2 facetting.
\item Annotations (exons and CDS regions) are displayed using \code{ggside} panel extensions.
}

Required packages: \code{dplyr}, \code{purrr}, \code{ggplot2}, \code{ggside}, \code{cowplot}, \code{zoo}, and optionally \code{ggpp} if signal range labeling is enabled.
}
\section{Notes}{

\itemize{
\item Smoothing uses center aligning for better positional accuracy (\code{align = "center"} in rolling sum).
\item If the \code{zoo} package is missing when \code{smooth = TRUE}, a warning will be issued.
\item Replicate variance visualization is only available when \code{merge_rep = TRUE}.
}
}

\examples{
\dontrun{
# Given a serp object
data(serp_example)

# Basic plot with smoothing
enrichment_plot2(serp_example)

# Plot without smoothing
enrichment_plot2(serp_example, smooth = FALSE)

# Merge replicates and plot mean ± SD
enrichment_plot2(serp_example, merge_rep = TRUE)

# Plot nucleotide positions (including UTRs)
enrichment_plot2(serp_example, mode = "nt", retain_cds = FALSE)

# Return processed data
df <- enrichment_plot2(serp_example, return_data = TRUE)
}

}
