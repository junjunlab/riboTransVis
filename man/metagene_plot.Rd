% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/visualization-QC.R
\name{metagene_plot}
\alias{metagene_plot}
\alias{metagene_plot,ribotrans-method}
\title{Generate Metagene Plots for Ribosome Profiling Data}
\usage{
metagene_plot(object, ...)

\S4method{metagene_plot}{ribotrans}(
  object,
  do_offset_correct = FALSE,
  position_shift = 0,
  type = c("rel2start", "rel2stop"),
  return_data = FALSE,
  mode = c("nt", "codon"),
  read_length = c(25, 31),
  rel2st_dist = c(-50, 100),
  rel2sp_dist = c(-100, 50),
  facet_wrap = ggplot2::facet_wrap(~sample)
)
}
\arguments{
\item{object}{A \code{ribotrans} object containing ribosome profiling data.}

\item{...}{Additional arguments (currently unused).}

\item{do_offset_correct}{Logical. If \code{TRUE}, performs \strong{offset correction}
using \code{do_offset_correction()}. \strong{Default}: \code{FALSE}.}

\item{position_shift}{Integer defining how much to adjust \strong{ribosome footprint positions}
during offset correction. \strong{Default}: \code{0}.}

\item{type}{Character. Defines metagene analysis type:
\itemize{
\item \code{"rel2start"} (default): Plots occupancy relative to \strong{start codon}.
\item \code{"rel2stop"}: Plots occupancy relative to \strong{stop codon}.
}}

\item{return_data}{Logical. If \code{TRUE}, returns processed \strong{occupancy data}
instead of plotting. \strong{Default}: \code{FALSE}.}

\item{mode}{Character. Defines the \strong{x-axis resolution}:
\itemize{
\item \code{"nt"} (default): Positions in \strong{nucleotides (nt)}.
\item \code{"codon"}: Positions in \strong{codon units (3-nt bins)}.
}}

\item{read_length}{Numeric vector, specifying accepted \strong{ribosome-protected fragment (RPF) lengths}.
\strong{Default}: \code{c(25,31)}.}

\item{rel2st_dist}{Numeric vector of length 2, defining the \strong{window range} (\strong{nt})
for \code{"rel2start"} plots. \strong{Default}: \code{c(-50,100)}.}

\item{rel2sp_dist}{Numeric vector of length 2, defining the \strong{window range} (\strong{nt})
for \code{"rel2stop"} plots. \strong{Default}: \code{c(-100,50)}.}

\item{facet_wrap}{A \code{ggplot2::facet_wrap()} object to define \strong{faceting} for multiple samples.
\strong{Default}: \code{ggplot2::facet_wrap(~sample)}.}
}
\value{
\itemize{
\item If \code{return_data = FALSE}: Returns a \code{ggplot} object of the \strong{metagene plot}.
\item If \code{return_data = TRUE}: Returns a \code{data.frame} with:
\itemize{
\item \code{sample}: Sample names.
\item \code{rel}: Relative position (nt or codon).
\item \code{avg}: \strong{Mean normalized ribosome occupancy} at each position.
}
}
}
\description{
This function creates \strong{metagene plots}, visualizing \strong{ribosome occupancy} relative
to \strong{start/stop codons} in translated mRNA regions (CDS).
}
\details{
\itemize{
\item The function computes \strong{ribosome footprint density} aligned to \strong{start or stop codons}.
\item If \code{mode = "codon"}, positions are converted to \strong{codon units} (i.e., \code{rel/3}).
\item The occupancy is \strong{normalized by average translation density} to account for
differences in transcript lengths.
}
}
\examples{
\dontrun{
# Metagene profile aligned to start codon (default)
p <- metagene_plot(obj, type = "rel2start", mode = "nt")
print(p)

# Return occupancy data instead of a plot
data <- metagene_plot(obj, type = "rel2stop", mode = "codon", return_data = TRUE)
head(data)

# Customize plot with ggplot2
ggplot(data, aes(x = rel, y = avg, color = sample)) +
    geom_line() +
    theme_minimal()
}

}
