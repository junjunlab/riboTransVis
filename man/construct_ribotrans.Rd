% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class.R
\name{construct_ribotrans}
\alias{construct_ribotrans}
\title{Construct a Ribotrans Object for Transcriptome or Genome Mapping}
\usage{
construct_ribotrans(
  genome_file = NULL,
  gtf_file = NULL,
  mapping_type = c("transcriptome", "genome"),
  assignment_mode = c("end5", "end3"),
  extend = FALSE,
  extend_upstream = 0,
  extend_downstream = 0,
  RNA_bam_file = NULL,
  RNA_sample_name = NULL,
  Ribo_bam_file = NULL,
  Ribo_sample_name = NULL,
  choose_longest_trans = FALSE
)
}
\arguments{
\item{genome_file}{A \code{character} string indicating the path to the genome sequence file
if the extend option is \code{TRUE}. Default is NULL.}

\item{gtf_file}{A \code{character} string indicating the path to the GTF annotation file.}

\item{mapping_type}{Character. Either \code{"transcriptome"} or \code{"genome"}, indicating whether
RNA-seq/Ribo-seq alignments are transcriptome-based or genome-based. Default is \code{"transcriptome"}.

\strong{Read alignment strategy:}

\describe{
\item{Transcriptome alignment:}{
Reads are aligned directly to the reference transcriptome (i.e., all RNA sequences).

In this case, both single-end and paired-end reads—regardless of being aligned to the positive or negative strand—have their BAM \code{pos} field consistently representing the biological 5' end of the read. This makes assignment straightforward.
}

\item{Genome alignment:}{
Reads are aligned to the reference genome (chromosomal DNA sequences), which requires strand-aware determination of the biological 5' end.

\strong{Single-end sequencing:}
\itemize{
\item{If read is aligned to the positive strand (flag = 0), and the gene is on the positive strand → 5' end = BAM \code{pos}.}
\item{If read is aligned to the negative strand (flag = 16), and the gene is on the negative strand → 5' end = \code{pos + read_length - 1}.}
}

\strong{Paired-end sequencing (R1 and R2 considered separately):}
For ribosome profiling libraries (~30 nt insert size), both ends generally contain the same fragment; typically one end (e.g., R1) is used. However, the biological 5' end depends on whether data is from R1 or R2:

\emph{R1 (first read in pair):}
\itemize{
\item{If read aligns to the negative strand (flag = 16, R1), gene is on the positive strand → 5' end = BAM \code{pos}.}
\item{If read aligns to the positive strand (flag = 0, R1), gene is on the negative strand → 5' end = \code{pos + read_length - 1}.}
}

\emph{R2 (second read in pair):}
\itemize{
\item{If read aligns to the positive strand (flag = 0), gene is on the positive strand → 5' end = BAM \code{pos}.}
\item{If read aligns to the negative strand (flag = 16), gene is on the negative strand → 5' end = \code{pos + read_length - 1}.}
}
}
}}

\item{assignment_mode}{Character. Specifies the read assignment strategy. Choices are:
\itemize{
\item{\code{"end5"}: Assign reads based on the 5' end of each aligned read.}
\item{\code{"end3"}: Assign reads based on the 3' end of each aligned read.}
}

\strong{Interpretation depends on \code{mapping_type} and sequencing type:}

\describe{
\item{When \code{mapping_type == "transcriptome"}:}{
Reads are aligned to transcript sequences (i.e., spliced mRNA).

In this case, the BAM \code{pos} field always represents the biological 5' end of a read, regardless of strand or read direction.

Therefore:
\itemize{
\item{\code{assignment_mode = "end5"} assigns reads by their biological 5' end}
\item{\code{assignment_mode = "end3"} assigns reads by their biological 3' end}
}
}

\item{When \code{mapping_type == "genome"}:}{
Reads are aligned to the genome; strand information is essential to determine the biological 5' end. Behavior differs by sequencing type:

\strong{Single-end reads:}
\itemize{
\item{For reads aligned to the positive strand (flag = 0), biological 5' end = \code{pos}}
\item{For reads aligned to the negative strand (flag = 16), biological 5' end = \code{pos + read length - 1}}
\item{→ Set \code{assignment_mode = "end5"} to assign reads to their biological 5' end}
}

\strong{Paired-end reads:}
In ribosome profiling, only one read (e.g., R1 or R2) is typically analyzed. The biological 5' end of the RNA fragment depends on which read you use:

\emph{If using R1 (first read in pair):}
\itemize{
\item{Flag = 0 (R1 on + strand): R1 represents the 3' end of the fragment}
\item{Flag = 16 (R1 on − strand): R1 represents the 5' end of the fragment}

\item{→ To assign reads to biological 5' end, set \code{assignment_mode = "end3"} (uses read's 3' end)}
\item{→ To assign reads to biological 3' end, set \code{assignment_mode = "end5"} (uses read's 5' end)}
}

\emph{If using R2 (second read in pair):}
\itemize{
\item{Flag = 0 (R2 on + strand): R2 represents the 5' end of the fragment}
\item{Flag = 16 (R2 on − strand): R2 represents the 3' end of the fragment}

\item{→ To assign reads to biological 5' end, set \code{assignment_mode = "end5"} if R2 flag = 0, or \code{"end3"} if R2 flag = 16}
}
}
}}

\item{extend}{Logical. Whether to extend sequences upstream and downstream of transcripts.
Default is FALSE.}

\item{extend_upstream}{Numeric. Number of bases to extend upstream of transcript start.
Only used when extend = TRUE. Default is 0.}

\item{extend_downstream}{Numeric. Number of bases to extend downstream of transcript end.
Only used when extend = TRUE. Default is 0.}

\item{RNA_bam_file}{A \code{character} vector containing paths to RNA-seq BAM files.}

\item{RNA_sample_name}{A \code{character} vector representing RNA-seq sample names.}

\item{Ribo_bam_file}{A \code{character} vector containing paths to ribosome profiling BAM files.}

\item{Ribo_sample_name}{A \code{character} vector representing ribosome profiling sample names.}

\item{choose_longest_trans}{Logical value indicating whether to select the longest transcript
for each gene. If TRUE, only the longest transcript (based on CDS and transcript length)
will be kept for each gene. This is useful to reduce redundancy when multiple transcript
isoforms exist for a gene. If FALSE (default), all transcripts will be retained.}
}
\value{
An object of class \code{ribotrans} containing BAM file metadata,
library information, and parsed transcriptomic features.
}
\description{
\code{construct_ribotrans()} generates a structured object with transcript or genomic annotations
and mapped RNA-seq / Ribo-seq library information. It supports selecting the longest transcript for each gene.
}
\details{
This function processes the transcriptome annotation and extracts alignment
information from RNA and ribosome profiling BAM files to create
an S4 object of class \code{ribotrans}.

It computes total mapped reads for each BAM file and stores the information
in the \code{library} slot of the \code{ribotrans} object.
}
\examples{
\dontrun{
ribotrans_obj <- construct_ribotrans(
  gtf_file = "example.gtf",
  mapping_type = "transcriptome",
  RNA_bam_file = c("rna1.bam", "rna2.bam"),
  RNA_sample_name = c("sample1", "sample2"),
  Ribo_bam_file = c("ribo1.bam"),
  Ribo_sample_name = c("sample3"),
  choose_longest_trans = TRUE
)
}


}
